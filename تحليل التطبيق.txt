
في البداية قبل أن نتحدث عن الينايوهات : سنلغي فكرة : الرسوم البيانية: يعرض بيانات مرئية (fl_chart)، مثل ملخصات الديون والمدفوعات.

وأيضاً : سنعتمد الفاير بيز كقاعدة بيانات التطبيق وسنحذف ال sqflite من التطبيق لأننا سنتعامل مع وضع الأونلاين والأوفلاين سيكون باستخدام الفاير بيز

وأخيرا سيكون هناك طريقة للزبون لتسجيل حساب في التطبيق ثم يكون ويرتبط بالحسابات التي يدين لها بالمال أي عدة محلات مرتبطة بنفس الحساب الخاص بالزبون

وسيكون أساس التطبيق ليس البريد الإلكتروني أو رقم الهاتف بل رقم مميز للعميل يتكون من 7 خانات يتولد عشوائياً ويكون فريد أي أنه لا يتكرر عند أي حساب أخر ويكون هذا الحساب مرتبط بالبريد الإلكتروني كخيار تسجيل دخول أخر وسيكون هناك تحقق من أن البريد الإلكتروني صحيح وحقيقي عبر خدمة التحقق المدمجة في الفاير بيز

سنتفصل في هذه المواضيع لا حقاً

الأن لنعود إلى السيناريو الخاص بصاحب العمل: سنعدل على : خوفًا من فقدان بياناته، يستخدم "أحمد" ميزة النسخ الاحتياطي لإنشاء نسخة من قاعدة بياناته وحفظها على Google Drive. لا داعي لها بما أن هناك قواعد بيانات في الفاير بيز فحتى لو حذف صاحب العمل أو الزبون التطبيق ستكون بياناته موجودة في الفاير بيز ويستطيع العودة لها عبر تسجيل الدخول برقمه المميز وكلمة المرور الخاصة به أو البريد الإلكتروني مع كلمة المرور الخاصة به

الفترة المجانية ستكون لمدة شهر من تاريخ إنشاء حساب مالك المنشاءة ثم لا يستطيع الدخول للحساب الخاص به إلا بعد أن يشترك في التطبيق

وأيضاً : عند إضافة عميل يتم إضافة هذا العميل عن طريق خيارين إما زبون مسجل حساب في التطبيق مسبقاً أو زبون جديد ليس لديه حساب في التطبيق من قبل

في سيناريو أن الزبون يملك حساب بالفعل سيقوم مالك المنشأة بإدخال الرقم المميز الخاص بالزبون وسيتم إضافته في زبائن مالك المنشأة وأيضاً سيتم إضافة المحل هذا في قائمة المحلات الخاصة بالزبون وهناك أيضاً حد الدين المسموح الذي يفترض أن لا يستطيع الزبون تخطيه إلا بإذن صاحب المنشأة بما يعني حتى الموظفين الذين لهم صلاحيات تسجيل الديون والدفعات ليس لهم القدرة على إضافة دين فوق الحد الأساسي للزبون ويمكنلصاحب المنشأة تعديل الحد الخاص بالدين للزبون من داخل واجهة معلومات الزبون

الأن لننتقل إلى سيناريو مهم جدا وهو سيناريو إضافة زبون ليس له حساب : سيقوم صاحب المنشأة عند إضافة زبون بإختيار خيار زبون ليس له حساب سابق وسيقوم بإنشاء حساب مؤقت للزبن هذا وسيكون في واجهة إدخال اسم الزبون وحد الدين وأخيراً سيظهر رقم مميز لهذا الحساب المؤقت وكما قلت يجب أن يكون هذا الرقم المميز ليس له مثيل في كل قواعد البيانات الخاصة بالتطبيق وسيكون الرقم المميز الذي يظهر في الأعلى في خانة غير قابلة للتعديل أي فقط للقرائة فقط وعند الضغط على زر إضافة عميل ستم إرسالهذه البيانات إلى قواعد البيانات عميل لكن عند تسجيل هذا العميل حساب فإنه يختار لدي رقم مميز بالفعل أي أنه قد إشترك مع صاحب منشأة أو أكثر قبل أن ينشئ حسابه ويتابع بالحساب المرتبط بالرقم المميز وسيضيف بريده الإلكتروني و يكتب إسم بدلاً عن اسمه السابق الذي كان مؤقت وكلمة المرور الخاصة به

الأن لننتقل إلى إضافة موظف عند الضغط على إضافة موظف ستظهر واجهة خاصة بإضافة موظف _وهي موجودة فعلا في الأكواد لكن تحتاج إلى تعديل _ وسيتطيع المالك من إضافة صلاحيات التي يريدها لهذا الموظف مثل تسجيل الديون أو تسجيل الدفعات وهكذا وسيكتب اسم الموظف وأيضا سيتم توليد رقم مميز خاص بحساب الموظف وكلمة مرور من إنشاء المالك للمنشأة

الأن لننتقل إلى سيناريو الموظف بما أنه يعتبر سيناريو جديد بعد أن يضيف صاحب المنشأة موظف هذا الموظف سيدخل إلى الواجهة الخاصة به التي ستكون مثل شاشة صاحب المنشأة لكن ستكون ديناميكية على حسب الصلاحيات الممنوحة له من قبل صاحب المنشأة والتي يمكن تعديلها من قبل صاحب المنشأة من عند واجهة الموظفين وعند الضغط على موظف سيدخل على معلومات الموظف الذي سيكون فيها كل معلومات الموظف وكل العمليات التي قام بها الموظف أي أن صاحب المنشأة يمكنه أن يراقب عمل الموظف من خلال هذه الواجهة ومن خلالها يمكنه التعديل على اسم وكلمة مرور الموظف لنعود للموظف وكما قلت ستكون شاشة تظهر فيها الإشياء التي تم إعطاء الصلاحيات لها مثل تسجيل الديون وهذه واجة الموظف بكل بساطة

وأخيرا سيناريو الزبون : الزبون وكما أسلفنا عندما يسجل حساب جديد لديه خياران في البداية إنشاء حساب جديد وتحته ملاحظة أنه ليس مرتبط بأي محل وعند الضغط على هذا الخيار سيتم توليد رقم مميز له بعد الإنتهاء من التسجيل كنافذة منبثقة فيها نص يقول "هذا هو الرقم المميز الخاص بك يرجى حفظة أو عمل لقطة شاشة له لأنه سيكون عبره ربط حسابك مع أصحاب المحلات " ثم سيظهر الرقم المميز الخاص به بنص أكبر من النص السابق للوضوح والأن لنكمل سناريو التسجيل الخاص بالزبون وكما قلنا عند اختيار أحد الخيارين الذين هما إنشاء حساب جديد وتحته ملاحظة أنه ليس مرتبط بأي محل وخيار حساب مرتبط بمحلات مسبقا وعند الضغط على هذا الخيار الثاني ستظهر خانة جديدة ويدخل الرقم المميز الذي قد تم إنشاءه من قبل صاحب المحل الذي أضافه كعميل جديد بدون حساب سابق

وبعد هذين الخيارين سيكون هذه الخانات موجودة في أي نوع من الخيارين وهم الأسم والبريد الإلكتروني وأيضا كلمة المرور وتكرارها وبالأسفل زر إنشاء حساب وبعد الضغط عليه سيتم إنشاء حساب جديد تماماً في حالة المستخدم اختار خيار حساب جديد ليس مرتبط بأي محل وبعد التسجيل ستظهر النافذة منبثق التي تحدثنا عنها الخاصة بالرقم المميز

وأما إذا كان اختار حساب مرتبط بمحلات مسبقاً فسيتم تعديل حسابه المؤقت الذي أدخل رقمه المميز ويتم إعتماد الجديد أي أنه إذا غير اسمه عن أسم الذي أعطاه صاحب المحل سيتعدل في كل المحلات المرتبط بها وهكذا وأخيرا سيتم نقله لصفحة تحقق من البريد الإلكتروني ويتم التحقق عبر الفاير بيز من صحة رمز الإدخال الذي سيظهرفي حساب المستخدم هذا الشيء سيكون موجدو أيضا في واجهة إنشاء حساب مالك المنشأة للتحقق من أن البيانات حقيقية هذا طبعا إذا أدخله لأن هذه الخانة ستكون اختيارية

:والأشياء التي لن نحتاجها هي

الوصول الآمن للحساب:
يفتح "أحمد" تطبيق "دائن ومدين"، يذهب إلى ملف العميل "محمد"، ويضغط على خيار جديد مثل "بوابة العميل" أو "مشاركة الحساب". يقوم التطبيق بإنشاء رابط ويب آمن وفريد خاص بحساب "محمد" ويعرضه على شكل رمز QR.

2.استعراض الحساب:

يقوم "محمد" باستخدام كاميرا هاتفه لمسح رمز الـ QR الذي على شاشة هاتف "أحمد". يفتح الرابط في متصفح الإنترنت على هاتف "محمد" صفحة ويب بسيطة وأنيقة تحمل شعار متجر "أحمد". في هذه الصفحة، يرى "محمد" فقط معلوماته الخاصة: اسمه ورصيده الإجمالي الحالي (مثلاً: متبقي 200 ريال). قائمة واضحة بجميع معاملاته بالترتيب الزمني: كل عملية شراء (دين) وكل دفعة قام بها. لا يمكنه تعديل أي شيء، الصفحة للقراءة فقط.

وكسيناريو بديل لهذه عند تسجيل الزبون للدخول بعد إنشاء حسابه إما عبر الرقم أوعبرالبريد الإلكتروني الذي أدخله في حسابه إذا أدخله بالفعل وكلمة المورو الخاصة بالحساب ستظهر له في البداية شاشة المحلات الذي هو مسجل فيها مع شريط بحث في الأعلى للبحث عن أي محل _وهذه الشاشة موجودة مسبقا لكن تحتاج الربط بقواعد البيانات فقط _ وسيكون في هذه الشاشة أيقونة إشعارات تخبر المستخدم أنه تم تسجيل عليه دين أو دفعة جديد وعند الضغط عليها سيدخل شاشة الإشعارات وستكون فيها الإشعارات الخاصة بالديون والدفعات الجديدة مع المحل الذي هوسبب هذا الإشعار وطبعا هذه الإشعارات ستظهر حتى خارج التطبيق وهو مغلق عند فتح النت سيقوم التطبيق بالقيام بمزامنة البيانات تلقائياً مثل الإشعارات وغيرها وعند وجود إشعارات جديد سيقوم التطبيق بتنبيه المستخدم وعند الضغط على أي محل سيتم إدخاله الزبون لشاشة المحل الذي ضغطه وتظهر في هذه الشاشة البيانات الخاصة بالزبون من ديون ودفعات الخاصة بهذا المحل مع إمكانية الزبون من طلب كشف حساب لديونه ومدفوعاته التي في هذا الشهرالخاصة بهذا المحل الذي هو بداخله الأن أو طلب دفعة أو مشتريات من قائمة الطلبات وتظهر للمالك أو الموظف الذي له صلاحيات الخاصة بالإشعارات وعند الضغط عليها سيمكن للمالك المنشأة أو الموظف المخول له بهذا بأن يسجل دين بالأشياء المسجلة بطلب مشتريات او دين ثم يقوم بتسجيله كدين جديد وأخيرا القدرة على العودة إلى شاشة المحلات السابقة لسهولة التنقل وأخيرا في شاشة المحلات سيكون فيها الملف الشخصي بالزبون الذي من خلاله يستطيع رؤية إحصائياته من إجمالي ديونه ومدفوعاته والمتبقي ووأيضاً تعديل اسمه والبريد سيمكنه من هنا إضافة بريد إكتروني وعند الإضافة أو التغيير سيتم التحقق من أنه بريد إكتروني صحيح وأيضا من هنا يمكنه تفعيل البصمة وتغيير كلمة المرور لكن بعد كتابة كلمة المرور القديمة أولاً والتحقق منها ثم يمكنه تغييرها















هيكلة السيناريو :

ملخص الرؤية الجديدة للتطبيق
1. التغييرات المعمارية الأساسية:

قاعدة البيانات: سيتم حذف sqflite بالكامل والاعتماد على Firebase كقاعدة بيانات أساسية. هذا سيوفر مزامنة تلقائية للبيانات (أونلاين/أوفلاين) ويجعل ميزة النسخ الاحتياطي اليدوي غير ضرورية.
هوية المستخدم: المعرّف الأساسي لكل المستخدمين (ملاك، موظفين، زبائن) لن يكون البريد الإلكتروني، بل رقم مميز فريد من 7 خانات يتم إنشاؤه تلقائيًا.
الرسوم البيانية: سيتم إلغاء fl_chart وإزالة واجهات الرسوم البيانية.
المصادقة: ستتم عبر Firebase Authentication، وتدعم:
تسجيل الدخول بالرقم المميز + كلمة المرور.
تسجيل الدخول بالبريد الإلكتروني + كلمة المرور (كخيار ثانوي).
التحقق من صحة البريد الإلكتروني.
2. سيناريو صاحب المنشأة (أحمد):

الاشتراك: فترة تجريبية لمدة شهر واحد، بعدها يُقفل الحساب ويتطلب اشتراكًا لاستخدامه.
إضافة عميل:
عميل مسجل: يتم إضافته عبر إدخال رقمه المميز.
عميل غير مسجل: يتم إنشاء "حساب مؤقت" له باسم وحد دين، مع توليد رقم مميز جديد يُعطى للعميل ليستخدمه لاحقًا في إنشاء حسابه الكامل.
حد الدين: لكل عميل حد دين لا يمكن للموظفين تجاوزه. المالك فقط يستطيع تعديل هذا الحد.
إضافة موظف: يقوم المالك بإنشاء حساب للموظف، حيث يتم توليد رقم مميز له وتعيين كلمة مرور وصلاحيات محددة (مثل تسجيل دين، تسجيل دفعة).
3. سيناريو الموظف (علي):

يسجل الدخول برقمه المميز وكلمة المرور.
واجهته ديناميكية، تعرض فقط الوظائف التي لديه صلاحية للوصول إليها.
يمكن للمالك مراقبة جميع عمليات الموظف وتعديل بياناته وصلاحياته.
4. سيناريو الزبون (محمد):

تم إلغاء فكرة بوابة العميل (الرابط والـ QR Code) بالكامل.
التسجيل:
حساب جديد كليًا: ينشئ حسابًا، وبعد التسجيل يظهر له رقمه المميز في نافذة منبثقة ليحفظه.
لديه حساب مؤقت: يختار "حساب مرتبط بمحلات مسبقًا"، يدخل رقمه المميز، ثم يكمل بياناته (الاسم، البريد، كلمة المرور) لترقية حسابه المؤقت إلى حساب دائم.
الواجهة الرئيسية: بعد تسجيل الدخول، يرى قائمة بالمحلات المرتبط بها مع شريط بحث.
الإشعارات: تصله إشعارات فورية (حتى لو التطبيق مغلق) عند تسجيل أي دين أو دفعة جديدة عليه.
واجهة المحل: عند اختيار محل معين، يرى كشف حسابه الخاص بهذا المحل فقط.
الميزات التفاعلية: يمكنه "طلب مشتريات" أو "طلب تسجيل دفعة"، حيث يرسل إشعارًا للمالك/الموظف لاتخاذ إجراء.
الملف الشخصي: يمكنه تعديل بياناته، تفعيل البصمة، وتغيير كلمة المرور.
لقد قمت بتدوين هذه المتطلبات بدقة. هذه الرؤية الجديدة تجعل التطبيق نظامًا بيئيًا متكاملًا (Ecosystem) يربط بين أصحاب المتاجر والموظفين والعملاء بطريقة تفاعلية ومركزية عبر الإنترنت.

هل هذا الملخص يغطي جميع النقاط التي ذكرتها بدقة؟

بمجرد تأكيدك، سأضع خطة عمل للبدء في تنفيذ هذه التغييرات الجذرية، وستكون الخطوة الأولى هي إزالة sqflite ودمج Firebase في المشروع.









تكلمة سيناريو التطبيق:


هذا رائع بقية بعض الملاحظات التي يجب أن نفصلها في سيناريو الموظف والمالك وهي في الموظف كما قلنا سيكون هناك أيقونة للإشعارات التي يمكن أن تظهر خارج التطبيق وهذا للموظفين المسموح لهم بذلك وعند الضغط على الأيقونة سيتم الدخول إلى واجهة الإشعارات الخاص بالموظف والتي سكون فيها إشعارات طلب مشتريات أو دفعات وماشابه هذا

وأيضا كما في الموظفين ستكون الاشعارات موجودة عند الملاك لكن بزايدة إشعارات التحديثات الجديدة وسيكون هذا عند كل أنواع المستخدمين ملاك أو غيرهم ثم سيكون لديه إشعارات طلب المدفوعات والمشتريات أو الديون التي تاتي من الزبائن وأيضاً إشعارات العمليات التي يقوم بها الموظفين من تسجيل ديون أو مدفوعات ويمكن في واجهة الإشعارات أن تفلتر الإشعارات من إشعارات خاص بالنظام مثل قرب إنتهاء الإشتراك أو تحديثات النظام أو المميزات الجدبدة التي تم إضافتها في التحديث وخاصة بالموظفين وخاصة بالزبائن

وبهذا نكون أنهينا موضوع الإشعارات والأن عند الموظف سيكون هناك شاشة خاصة بالملف الشخصي وفيها تعديل كلمة المرور و إضافة بريد إلكتروني لحسابه وتفعيل البصمة

وأما عند الملك سنبدأ بإنشاء حساب وأولاً عند الضغط على زر إنشاء حساب جديد عند مالك المنشأة سيتم فتح صفحة إنشاء حساب خاصة به وستم إدخال معلومات المحل وهذه المعلومات هي : 1. اسم المحل 2. نوع النشاط مثل بقالة أو مطعم أو محل جملة وهكذا 3. العنوان وهو إختياري 4. العملة الذي يتعامل بها في المحل وستكون قائمة منسدلة فيها عمل الدول العربية و الدولار

ثم يضغط زر التالي لينتقل إلى الخطوة القادمة في إنشاء حساب سيظهر له في الخطوة الثانية معلومات المالك وهي : 1.الاسم الكامل 2.البريد الإلكتروني إختياري ويمكن إضافته لاحقاً من عند الملف الشخصي للمالك 3.اسم البنك ورقم الحساب وهذه الخانيتين إختياريتين ولكن إذا كتب في إحداها يجب ملء الثانية 4. رقم هاتف الخاص بمالك المنشأة الذي يتعامل به في المحافظ الإلكترونية

ثم يضغط زر التالي لينتقل إلى الخطوة القادمة في إنشاء حساب سيظهر له في الخطوة الثالثة كلمة المرور والموافق على سياسة الخصوصة

ثم الضغط على زر إنشاء حساب إذا أضاف بريد إلكتروني ستظهر شاشة تحقق لن يتم تسجيل الحساب في قواعد البيانات إلا بعد التحقق من صحة البريد الإلكتروني

أما إذا لم يدخل بريد سيتم تسجيل بياناته في قواعد البيانات مباشرة مع رقمه المميز الذي يتولد مباشرة بعد الضغط على الزر الخاص بإنشاء حساب وهو يتولد في كلتى الحالتين إذا أدخل بريد إلكتروني وتحقق منه أو لم يدخل وسيظهر له بعد أن يتم إنشاء حسابه وستظهرالنافذة المنبثقة التي قلت لك عليها في إنشاء حساب خاص بالزبون ستكون نفس المحتوى باخلاتف الرقم المميز الخاص بهذ الحساب بالطبع

وسيكون هناك وضع أوف لاين عند الدخول لحساب المستخدم سيستطيع أنيدخل عبرالطرق التي أتفقنى عليها عند تفعيل خيار وضع الأوفلاين وسيكون مكانه بدل تشيك بوكس المسمى تذكرني للأننى سنحذفه ونستبدله بهذا الوضع والذي يسمح للمستخدم الدخول إلى حسابه بدون نت عبر التسجيل بأي طريقة تحدثنا عنها مع التحقق الداخلي من قواعد البيانات التي في الجهاز وعند الدخول سيكون مقيد بوضع القرائة فقط أي أنه لا يمكنه طلب مشتريات أو طلب دفعة من جهة الزبون وما شبه هذا من عمليات من ناحية الموظفين والملاك وعند إستخدام أي عملية ستظهر له رسالة منبثقةتقول هذا الإجراء لا يمكن القيام به في وضع الأوف لاين

وبهذا سيكون السيناريو الرئيسي للتطبيق شبه مكتمل إذا بقية هناك أي نقاط غير مفهومة أو لا تزال غامضة أو نقاط لا تزال ناقصة أخبرني لكي أشرحها لك



التأكيد النهائي على التفاصيل الإضافية
1. نظام الإشعارات المفصّل:

للموظف: ستكون لديه أيقونة إشعارات (إذا مُنحت له الصلاحية) لتلقي طلبات العملاء (مشتريات/دفعات) كإشعارات فورية.
للمالك: ستكون لديه واجهة إشعارات شاملة مع فلاتر:
إشعارات النظام: (تحديثات، قرب انتهاء الاشتراك).
إشعارات الموظفين: (كل عملية يقوم بها أي موظف).
إشعارات الزبائن: (طلبات المشتريات/الدفعات).
لجميع المستخدمين: سيتلقون إشعارات النظام العامة.
2. الملف الشخصي للموظف:

سيكون للموظف شاشة ملف شخصي خاصة به تمكنه من:
تغيير كلمة المرور.
إضافة/تغيير بريده الإلكتروني (مع التحقق).
تفعيل المصادقة بالبصمة.
3. عملية تسجيل حساب المالك (متعددة الخطوات):

الخطوة 1 (معلومات المحل): إدخال اسم المحل، نوع النشاط، العنوان (اختياري)، والعملة.
الخطوة 2 (معلومات المالك): إدخال الاسم الكامل، البريد الإلكتروني (اختياري)، معلومات البنك (اختياري)، ورقم هاتف المحافظ الإلكترونية (اختياري).
الخطوة 3 (كلمة المرور والموافقة): تعيين كلمة المرور والموافقة على سياسة الخصوصية.
منطق إنشاء الحساب: بعد الضغط على "إنشاء حساب"، يتم توليد الرقم المميز. إذا كان البريد الإلكتروني موجودًا، ينتقل للتحقق منه أولاً قبل حفظ الحساب. إذا لم يكن موجودًا، يتم حفظ الحساب مباشرة. وفي كلتا الحالتين، تظهر نافذة منبثقة في النهاية تعرض الرقم المميز للمالك.
4. وضع الأوفلاين (Offline Mode):

سيتم استبدال زر "تذكرني" في شاشة تسجيل الدخول بخيار "وضع الأوفلاين".
عند تفعيله، يمكن للمستخدم الدخول إلى حسابه بدون إنترنت (عبر التحقق من البيانات المخزنة محليًا).
سيكون التطبيق في وضع القراءة فقط (Read-only). أي عملية تتطلب تعديل البيانات (إضافة دين، طلب شراء، إلخ) ستكون معطلة وستظهر رسالة توضح ذلك.
بهذا، أعتقد أننا قمنا بتغطية كل جوانب السيناريو الرئيسي للتطبيق. الرؤية الآن متكاملة تمامًا.